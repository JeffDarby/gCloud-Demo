<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://apps.mypurecloud.com.au;
        style-src 'self' 'unsafe-inline';
        img-src 'self' https://apps.mypurecloud.com.au;
        connect-src 'self' https://api-cdn.mypurecloud.com.au https://api.mypurecloud.com.au wss://webmessaging.mypurecloud.com.au;
        frame-src 'self' https://apps.mypurecloud.com.au;
    ">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesys Cloud Testing</title>
    <script type="text/javascript" charset="utf-8">
        // Helper function to update Genesys configuration
        function updateGenesysConfig(deploymentId) {
            if (typeof Genesys === "function") {
                Genesys('config', {
                    environment: 'prod-apse2',
                    deploymentId: deploymentId
                });
            } else {
                console.error("Genesys function not loaded yet. Trying again...");
                setTimeout(() => updateGenesysConfig(deploymentId), 100); // Retry after a short delay
            }
        }

        // Function to change the deployment ID and save it
        function changeDeploymentId() {
            const deploymentPicker = document.getElementById('deploymentPicker');
            const selectedDeploymentId = deploymentPicker.value;

            // Update Genesys configuration
            updateGenesysConfig(selectedDeploymentId);

            // Save the deployment ID to local storage
            localStorage.setItem('selectedDeploymentId', selectedDeploymentId);
        }

        // Load the deployment ID on page load or set to default
        window.onload = function() {
            const deploymentPicker = document.getElementById('deploymentPicker');
            const storedDeploymentId = localStorage.getItem('selectedDeploymentId');

            // Check if a stored ID exists, otherwise use the default from the first option in the select
            const defaultDeploymentId = storedDeploymentId || deploymentPicker.options[0].value;
            deploymentPicker.value = defaultDeploymentId;

            // Apply the Genesys configuration
            updateGenesysConfig(defaultDeploymentId);
        };
    </script>
</head>
<body>
    <header>
        <h1>Welcome to the Genesys Cloud Messaging Test page</h1>
    </header>
    <nav>
        <!-- Navigation links go here -->
    </nav>
    <main>
        <select id="deploymentPicker">
            <option value="3baf8b66-380f-48b1-87b5-628c852cda3a">Budget Direct (Default)</option>
            <option value="deployment-id-2">Option 2</option>
            <option value="deployment-id-3">Option 3</option>
        </select>
        <button onclick="changeDeploymentId()">Apply Changes</button>
    </main>
    <footer>
        <!-- Footer content goes here -->
    </footer>
</body>
</html>
